üìå INSTRU√á√ïES PERMANENTES SOBRE A EXTRA√á√ÉO DO TELEFONE ‚Äì PROJETO WHATSAPP OR√áAMENTOS

‚ö†Ô∏è IMPORTANTE:
A extra√ß√£o do telefone do contato ativo no WhatsApp Web √© um ponto cr√≠tico do sistema.
Esse telefone √© utilizado como ID √∫nico do cliente em toda a estrutura da extens√£o.

üß© A fun√ß√£o atual de extra√ß√£o est√° validada em produ√ß√£o e N√ÉO DEVE SER MODIFICADA SEM JUSTIFICATIVA T√âCNICA CLARA.

‚úîÔ∏è REGRAS QUE DEVEM SER MANTIDAS:
- A fun√ß√£o deve continuar registrada em `chrome.runtime.onMessage.addListener`
- A extra√ß√£o deve acontecer dentro de uma fun√ß√£o an√¥nima autoexecut√°vel (IIFE)
- A chave de a√ß√£o usada na mensagem deve permanecer como `"extrairTelefone"`
- O retorno deve ser exatamente `{ telefone: string | null }`
- A extra√ß√£o deve funcionar mesmo com varia√ß√µes de layout do WhatsApp Web

üõë N√ÉO PERMITIDO:
- Substituir a estrutura do IIFE por fun√ß√µes externas
- Mover a l√≥gica para outro arquivo sem atualizar os testes
- Usar arrow functions ou tipagens extras no bloco de extra√ß√£o
- Alterar o nome da chave `"extrairTelefone"`
- Integrar a fun√ß√£o com outras responsabilidades (inje√ß√£o, renderiza√ß√£o, etc.)

üîÅ Caso precise refatorar:
A fun√ß√£o pode ser modularizada ou adaptada, porem apenas se extremamente nscess√°rio e com minha autoriza√ß√£o explicita, e, DESDE QUE:
- O comportamento de extra√ß√£o continue exatamente igual
- A assinatura e retorno da mensagem sejam mantidos
- O log continue vis√≠vel no DevTools para valida√ß√£o (console.log + console.error)

‚úÖ Valida√ß√£o ap√≥s qualquer altera√ß√£o:
- Verifique no DevTools do WhatsApp Web se a extra√ß√£o ocorre
- Confira se o log aparece no console:
  [WhatsApp Or√ßamentos] ‚úÖ Telefone extra√≠do: <n√∫mero>

Essa prote√ß√£o garante que os m√≥dulos de or√ßamento, hist√≥rico, tags e CRM funcionem corretamente.

Autor: Arquiteto de Software GPT
Data: 2025-05-04
